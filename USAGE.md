# 使用指南

## 快速开始

### 1. 创建项目

1. 打开应用后，在项目选择界面输入项目名称
2. 可选择输入项目描述
3. 点击"创建项目"按钮

### 2. 添加图像

有两种方式添加图像：

#### 方式一：MQTT 上传（推荐用于 IoT 设备）

设备端发布消息到 MQTT Topic: `annotator/upload/{project_id}`

消息格式：

```json
{
  "req_id": "uuid_v4_string",
  "device_id": "camera_01",
  "timestamp": 1717488000,
  "image": {
    "filename": "img_20240604_001.jpg",
    "format": "jpg",
    "encoding": "base64",
    "data": "base64_encoded_string"
  },
  "metadata": {
    "trigger_source": "sensor_A",
    "location": "factory_floor_1"
  }
}
```

参考 `backend/examples/mqtt_client_example.py` 查看完整示例。

#### 方式二：手动上传

目前需要直接通过 API 上传，后续版本将添加 Web UI 上传功能。

### 3. 创建类别

1. 在标注工作台中，点击右侧控制面板的"类别"标签
2. 输入类别名称
3. 选择类别颜色（点击颜色选择器）
4. 点击"创建"按钮

### 4. 开始标注

#### 矩形框标注

1. 按 `R` 键或点击工具栏的矩形框工具
2. 在图像上按住鼠标左键拖拽绘制矩形框
3. 松开鼠标完成标注
4. 系统会自动弹出类别选择，选择对应类别

#### 多边形标注

1. 按 `P` 键或点击工具栏的多边形工具
2. 依次点击图像上的顶点
3. 双击或按 `Enter` 键闭合多边形
4. 按 `Esc` 键可撤销上一个点

#### 关键点标注

1. 按 `K` 键或点击工具栏的关键点工具
2. 依次点击图像上的关键点位置
3. 系统会自动连接关键点（根据预设骨架）

#### 选择和编辑

1. 按 `V` 键或点击工具栏的选择工具
2. 点击已标注的物体进行选中
3. 可以拖拽边缘/角点调整大小（矩形）
4. 可以拖拽顶点调整位置（多边形）

### 5. 导航和查看

- `A` 或 `←`: 上一张图像（自动保存当前标注）
- `D` 或 `→`: 下一张图像（自动保存当前标注）
- `Space + 拖拽`: 平移画布
- 鼠标滚轮: 缩放画布（以鼠标位置为中心）
- `H`: 隐藏/显示所有标注

### 6. 编辑操作

- `Del` 或 `Backspace`: 删除选中的标注
- `Ctrl+Z`: 撤销
- `Ctrl+Shift+Z`: 重做
- `Ctrl+S`: 手动保存（通常自动保存）

### 7. 导出 YOLO 格式

1. 完成标注后，通过 API 调用导出端点：

```bash
curl -X POST http://localhost:8000/api/projects/{project_id}/export/yolo
```

2. 导出的文件将保存在 `datasets/{project_id}/yolo_export/` 目录下

目录结构：

```
yolo_export/
├── images/          # 图像文件
├── labels/          # 标注文件（.txt）
└── classes.txt      # 类别名称列表
```

## 快捷键参考

| 快捷键 | 功能 |
|--------|------|
| `R` | 矩形框工具 |
| `P` | 多边形工具 |
| `V` | 选择/移动工具 |
| `K` | 关键点工具 |
| `A` / `←` | 上一张图像 |
| `D` / `→` | 下一张图像 |
| `Space + 拖拽` | 平移画布 |
| `H` | 隐藏/显示标注 |
| `Del` / `Backspace` | 删除选中标注 |
| `Ctrl+Z` | 撤销 |
| `Ctrl+Shift+Z` | 重做 |
| `Ctrl+S` | 手动保存 |
| `Esc` | 取消当前操作 |
| `Enter` | 完成多边形绘制 |

## 界面说明

### 左侧工具栏

- **选择工具**: 选择和编辑已标注的对象
- **矩形框工具**: 绘制边界框标注
- **多边形工具**: 绘制多边形标注
- **关键点工具**: 标记关键点

### 中间画布区

- **十字准星**: 始终跟随鼠标，辅助精确定位
- **图像信息**: 左上角显示当前图像文件名和分辨率
- **标注预览**: 拖拽时显示虚线预览，完成后显示实线框

### 右侧控制面板

#### 标注列表标签

- 显示当前图像的所有标注
- 点击标注项可以选中对应的标注
- 标注项显示类别名称和颜色

#### 类别标签

- 显示项目所有可用类别
- 每个类别分配固定颜色
- 可以创建新类别

#### 文件标签

- 显示项目所有图像
- 绿色点表示已标注，灰色点表示未标注
- 点击图像项可以切换当前图像

## 最佳实践

1. **创建类别**: 在开始标注前，先创建所有需要的类别
2. **批量处理**: 使用键盘快捷键提高标注效率
3. **定期保存**: 虽然系统会自动保存，但建议定期使用 `Ctrl+S` 手动保存
4. **图像命名**: 建议使用有意义的文件名，便于后续管理
5. **导出前检查**: 导出 YOLO 格式前，检查所有标注是否正确

## 常见问题

### Q: 图像上传后看不到？

A: 检查图像路径是否正确，查看浏览器控制台的错误信息。确保后端图像文件服务正常工作。

### Q: 标注后如何修改类别？

A: 选中标注后，可以通过右侧类别列表重新选择类别（该功能待完善）。

### Q: 如何批量标注？

A: 使用快捷键可以快速切换工具和图像，提高标注效率。当前版本暂不支持批量操作，后续版本将添加。

### Q: 导出的 YOLO 格式可以直接用于训练吗？

A: 是的，导出的格式完全符合 YOLOv5/v8/v10/v11 的标准格式，可以直接用于训练。

## 技术支持

如有问题，请查看项目文档或提交 Issue。

